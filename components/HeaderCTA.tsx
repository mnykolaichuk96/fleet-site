"use client";
// ‚¨ÜÔ∏è –¶–µ Client Component, –æ—Å–∫—ñ–ª—å–∫–∏:
// - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è useRouter / usePathname
// - —î –æ–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É
// - —î –≤–∑–∞—î–º–æ–¥—ñ—è –∑ DOM (scroll)

import { usePathname, useRouter } from "next/navigation";
// ‚¨ÜÔ∏è useRouter   ‚Äî –¥–ª—è –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ—ó –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó (–∞–Ω–∞–ª–æ–≥ redirect —É SPA)
// ‚¨ÜÔ∏è usePathname ‚Äî –¥–æ–∑–≤–æ–ª—è—î –¥—ñ–∑–Ω–∞—Ç–∏—Å—å, –Ω–∞ —è–∫—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –º–∏ –∑–∞—Ä–∞–∑

import { scrollToElement } from "@/lib/scrollToElement";
// ‚¨ÜÔ∏è –£—Ç–∏–ª—ñ—Ç–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ —Å–∫—Ä–æ–ª—É –¥–æ DOM-–µ–ª–µ–º–µ–Ω—Ç–∞ –∑–∞ id

/**
 * –õ–æ–≥—ñ—á–Ω—ñ —Ü—ñ–ª—ñ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó.
 *
 * –¶–µ –ù–ï DOM id.
 * –¶–µ —Å–µ–º–∞–Ω—Ç–∏—á–Ω—ñ "–Ω–∞–º—ñ—Ä–∏", —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Header.
 *
 * TypeScript –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ:
 * - –Ω–µ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞—Ç–∏ –Ω–µ—ñ—Å–Ω—É—é—á–∏–π target
 * - –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –Ω–æ–≤–æ–≥–æ target –∫–æ–¥ –Ω–µ —Å–∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è,
 *   –ø–æ–∫–∏ –Ω–µ –±—É–¥–µ –æ–Ω–æ–≤–ª–µ–Ω–∏–π mapping –Ω–∏–∂—á–µ
 */
type Target = "cars" | "contact" | "cooperation-modes";

type Props = {
    // –õ–æ–≥—ñ—á–Ω–∞ —Ü—ñ–ª—å –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó (–Ω–µ id!)
    target: Target;

    // –¢–µ–∫—Å—Ç –∞–±–æ JSX –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–Ω–æ–ø–∫–∏
    children: React.ReactNode;

    // –í—ñ–∑—É–∞–ª—å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –∫–Ω–æ–ø–∫–∏
    // - "link"    ‚Üí —Ç–µ–∫—Å—Ç–æ–≤–∞ –∫–Ω–æ–ø–∫–∞
    // - "primary" ‚Üí –≥–æ–ª–æ–≤–Ω–µ CTA
    variant?: "primary" | "link";
};

/**
 * HeaderCTA
 *
 * –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –Ω–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.
 *
 * –ü–æ–≤–µ–¥—ñ–Ω–∫–∞:
 * - —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ ‚Üí –ø–ª–∞–≤–Ω–∏–π scroll
 * - —è–∫—â–æ –Ω–∞ —ñ–Ω—à—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ ‚Üí redirect –Ω–∞ home + scroll
 *
 * –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ù–ï –∑–Ω–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É DOM –Ω–∞–ø—Ä—è–º—É ‚Äî
 * –≤—ñ–Ω –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ –ª–æ–≥—ñ—á–Ω—ñ "targets".
 */
export default function HeaderCTA({
                                      target,
                                      children,
                                      variant = "link",
                                  }: Props) {
    // Router Next.js –¥–ª—è –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ—ó –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó
    const router = useRouter();

    // –ü–æ—Ç–æ—á–Ω–∏–π —à–ª—è—Ö, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
    // /pl
    // /pl/cars
    // /ua/drivers
    const pathname = usePathname();

    /**
     * –Ø–≤–Ω–∏–π mapping:
     * –ª–æ–≥—ñ—á–Ω–∏–π target ‚Üí —Ä–µ–∞–ª—å–Ω–∏–π DOM id
     *
     * –¶–µ –ö–õ–Æ–ß–û–í–ï –º—ñ—Å—Ü–µ:
     * - —Ç—É—Ç –∑ º—î–¥–Ω—É—î—Ç—å—Å—è –ª–æ–≥—ñ–∫–∞ —ñ DOM
     * - Header –Ω–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ id –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
     */
    const TARGET_ID_MAP: Record<Target, string> = {
        cars: "cars-preview",
        contact: "contact-form",
        "cooperation-modes": "cooperation-modes",
    };

    // –û—Ç—Ä–∏–º—É—î–º–æ DOM id, –¥–æ —è–∫–æ–≥–æ –±—É–¥–µ–º–æ —Å–∫—Ä–æ–ª–∏—Ç–∏
    const targetId = TARGET_ID_MAP[target];

    /**
     * –í–∏–∑–Ω–∞—á–∞—î–º–æ, —á–∏ –º–∏ –∑–Ω–∞—Ö–æ–¥–∏–º–æ—Å—è –Ω–∞ home page.
     *
     * –î–ª—è –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ —Å–∞–π—Ç—É:
     * /pl
     * /ua
     * /en
     *
     * –ü—ñ—Å–ª—è split("/") –º–∞—Å–∏–≤ –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫:
     * ["", "pl"]
     */
    const isHome = pathname.split("/").length === 2;

    /**
     * –ë–∞–∑–æ–≤–∏–π —à–ª—è—Ö –∑ locale.
     *
     * –ü—Ä–∏–∫–ª–∞–¥:
     * pathname = "/pl/cars"
     * localeBase = "/pl"
     *
     * –¶–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± –ù–ï –ª–∞–º–∞—Ç–∏ –ª–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—é
     * –ø—Ä–∏ router.push(...)
     */
    const localeBase = pathname.split("/").slice(0, 2).join("/");

    // CSS-–∫–ª–∞—Å–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≤–∞—Ä—ñ–∞–Ω—Ç—É –∫–Ω–æ–ø–∫–∏
    const baseClass =
        variant === "primary"
            ? "rounded-lg bg-red-600 px-4 py-2 text-sm text-white font-medium hover:bg-red-700"
            : "text-sm text-gray-700 hover:text-black";

    /**
     * –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É.
     *
     * –ê–ª–≥–æ—Ä–∏—Ç–º:
     * 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, –¥–µ –º–∏ –∑–∞—Ä–∞–∑
     * 2. –Ø–∫—â–æ home ‚Üí –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä–æ–ª–∏–º–æ
     * 3. –Ø–∫—â–æ –Ω–µ home ‚Üí —Ä–æ–±–∏–º–æ redirect –Ω–∞ home
     *    –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º ?scroll=...
     */
    const handleClick = () => {
        if (isHome) {
            // üü¢ –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç–∞
            // ‚Üí –ø–ª–∞–≤–Ω–∏–π scroll –¥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ—ó —Å–µ–∫—Ü—ñ—ó
            scrollToElement(targetId);
        } else {
            // üîµ –Ü–Ω—à–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞
            // ‚Üí —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ home –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º scroll
            router.push(`${localeBase}?scroll=${targetId}`);
        }
    };

    // –†–µ–Ω–¥–µ—Ä –∫–Ω–æ–ø–∫–∏
    return (
        <button onClick={handleClick} className={baseClass}>
            {children}
        </button>
    );
}
